import { Head, Notes, Image } from 'mdx-deck'
import Split from './src/Split'

export { theme } from './theme'

<Head>
  <title>BDD workshop</title>
</Head>

# Multi layer
# Outside in
# BDD
_Behaviour Driven Development_
# For modern rails apps

<Notes>
  <ul>
    <li>rails conf 2019</li>
    <li>with colleague Selena Small</li>
    <li>real demo mode</li>
  </ul>
</Notes>

---

## Modules

1. When Then steps
1. Page Fragments
1. Flows and Mechanics
1. Flakys
1. Drive new functionality through all the layers
1. How your tests will fail with refactors

---

# Modern rails app

- React SPA in places
- Admin and other rails views
- Rails backend as API
- Active record to DB
- dependency on external services

<Notes>
  <ul>
    <li>what it is</li>
  </ul>
</Notes>

---

# Tranditional view of testing

[Pyramid]

- UI tests
- Service layer Integration testing
- Traditional unit testing

<Notes>
  <ul>
    <li>happy case at the top</li>
    <li>integration testing</li>
    <li>unit as "isolated" unit</li>
    <li>number of tests at each layer</li>
  </ul>
</Notes>

---

# BDD
_Behaviour Driven Development_

<Notes>
  <ul>
    <li>test behaviour not implementation</li>
  </ul>
</Notes>

---

<Image
  style={{ width: '40vw', height: '70vh' }}
  src="https://cdn-images-1.medium.com/max/1600/1*SLmk-xp-dv7aS8XLabqlwA.gif"/>

<br />

<div style={{ fontSize: '0.7em' }}>
  https://medium.com/@Cyrdup/unit-testing-youre-doing-it-wrong-407a07692989
</div>

<Notes>
  <ul>
    <li>you want your code to have a use</li>
    <li>unit testing in isolation does not always do the trick</li>
  </ul>
</Notes>

---

# outside in

_layered like an onion_

* UI Flows
  * core business
* Page mechanics
  * possible interactions with a page
* Frontend Component Tests
* API Integration
* service layer tests
* Controller Unit
* Domain logic

<Notes>
  <ul>
    <li>Flows multi step with flow on effects</li>
    <li>Mechanics possible interactions expected and unexpected</li>
    <li>all are unit tests, boundary of units</li>
    <li>Key is an organisation of tests</li>
    <li>UI flow should describe a system</li>
  </ul>
</Notes>

---

# Module 1
## When Then steps

---

# Traditional Testing States

<table>
  <tr>
    <td>Given</td>
    <td>Arrange</td>
  </tr>
  <tr>
    <td>When</td>
    <td>Act</td>
  </tr>
  <tr>
    <td>Then</td>
    <td>Assert</td>
  </tr>
</table>

<Notes>
  <ul>
    <li>assumes the given setup is accurate to the behaviour of your app</li>
    <li>not case in real life</li>
    <li>user behaviour is not a 1 shot</li>
    <li>number of actions</li>
    <li>often a number of actors</li>
  </ul>
</Notes>

---

# Drop the Given

* ~~Given~~
* When
* Then

<Notes>
  <ul>
    <li>and get there through When Then steps</li>
  </ul>
</Notes>

---

* When
* Then


* When
* Then


* When
* Then

<Notes>
  <ul>
    <li>transition errors</li>
    <li>Given ties us to mocking implementation without testing it's integration</li>
  </ul>
</Notes>

---

# Example - signup to instagram

---

* **When** I visit https://www.instagram.com/
* **Then** I am shown login and signup details

<Image
  style={{ width: '35vw', height: '40vh' }}
  src={require('file-loader!./images/01_insta_visit.png')} />

---

* **When** I signup with
  * "Michael, saramic+2@gmail.com, saramic2020"
* **Then** I am on suggested people to follow page

<div style={{ marginLeft: '10vw', display: 'flex' }}>
<img
  style={{ width: '35vw', height: '40vh' }}
  src={require('file-loader!./images/02_insta_fillin.png')} />
<img
  style={{ marginLeft: '10vw', width: '35vw', height: '40vh' }}
  src={require('file-loader!./images/03_insta_recommend.png')} />
</div>

---

* **When** I follow instagram, mileycyrus, justinbieber
* **Then** It shows I am following them

<Image
  style={{ width: '35vw', height: '40vh' }}
  src={require('file-loader!./images/04_insta_follow.png')} />

---

* **When** I click get started
* **Then** I am encouraged to add my phone and connect through Facebook
* **And** I have stories from people I follow
* **And** I have suggestions
* **And** I have a feed of posts from people I follow
* **And** I have search, explore, activity, profile links at the top

<div style={{ display: 'flex', maxWidth: '80vw', maxHeight: '40vw' }}>
<Image
  style={{ width: '25vw', maxHeight: '40vh' }}
  src={require('file-loader!./images/05_insta_get_started_link.png')} />

<Image
  style={{ width: '25vw', maxHeight: '40vh' }}
  src={require('file-loader!./images/06_insta_feed_page.png')} />

<Image
  style={{ width: '25vw', maxHeight: '40vh' }}
  src={require('file-loader!./images/07_insta_recommend_in_feed.png')} />
</div>

---

# A number of different flows

- what if a chosen username is taken?
- password too weak?
- don't follow anyone?
- notification modal yes/no?

---

# What about more detail

- email invalid
- forgot to enter madatory fields
- got an error in submission
- username suggest not working

* NOT IN FLOW
- split into page mechanics

---

# let's bring back the Given

as a context
- context a user is signed up to insagram following 3 users

---

# Your turn

- explore?
- like?
- stories?
- profile?

---

# A demo app

<iframe frameborder="0" width="1400" height="600" src="http://localhost:3000/"></iframe>

- what is the flow?
- what could be the mechanics?

---

# Your turn

- write a flow for a user wants to play and needs a profile

---

# Let's take a look

_code dive_

<Notes>
<ul>
<li>straight out rspec</li>
<li>add when then steps</li>
<li>pull out page fragments</li>
</ul>
</Notes>

---

# A second flow that is broken

_with extension_

---

# Module 1 Review
## When Then steps

* mutlipe When Then actions add up to a flow
* `rspec-wait` helps organise `RSpec` tests
* _Key things that this will catch_
* _How to organise scenarios_

---

# Module 2
## Page Fragments

---

# Module 3
## Flows and Mechanics

---

# Module 4
## Flakys

---

# Module 5
## Drive new functionality through all the layers

---

# Module 6
## How your tests will fail with refactors

---

<https://github.com/failure-driven/game-app>

